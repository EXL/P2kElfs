#digest

Всегда хотел поиграться с RGB-подсветкой стереодинамиков, вспышкой камеры и датчиком освещённости на Motorola E398 и вот наконец-то дошли руки. Разобрался как там всё устроено и написал небольшое приложение, в котором реализовал кучу режимов от Ambilight до Stroboscope как на Siemens CX65. 

Посмотреть как оно выглядит можно в этом ролике на YouTube:

https://youtu.be/ilhGiRITd8U


1 -----


Исходный код приложения:

https://github.com/EXL/P2kElfs/tree/master/Ambilight

Скомпилированный ELF:


2 -----


Самый интересный режим, который я всегда хотел реализовать,  это подсветка Ambilight, как на крутых телевизорах Philips, когда берётся усреднённый цвет региона дисплея и этим цветом зажигается фоновая подсветка, как бы увеличивая этим размер экрана. На E398 это получилось довольно интересно.


3 -----


Чем E398 вам не ардуинка? Ведь тут тоже можно делать радугу на RGB-светодиодах!


4 -----


А вот простенькая реализация адаптивной подсветки дисплея, которая сегодня привычна на современных Android-смартфонах. Сигнал с датчика освещённости, который опрашивается раз в несколько милисекунд преобразуется в яркость подсветки дисплея, заставляя повышать или понижать её уровень в зависимости от яркости фонового освещения.


5 -----


Некоторые технические подробности.

RGB-светодиоды на Motorola E398/E1, V600/V620 и V80 завязаны на прикольную микросхему National Semiconductor LP3933, которая управляется по SPI прямиком с Neptune SoC и предоставляет шесть каналов для управления белыми светодиодами и два канала для управления RGB светодиодами.

По принципиальной схеме два боковых RGB-светодиода на E398 подключены на один RGB-канал микросхемы, поэтому их нельзя разделить, то есть сделать условную полицейскую мигалку, когда один RGB-светодиод будет гореть красным, а другой синим. На втором RGB-канале висит внезапно вспышка камеры, это позволяет тонко регулировать её яркость, хотя в прошивке подобное не особо используется. Разве что в момент снимка яркость вспышки увеличивается на сотню миллисекунд.

Кроме того у E398 для подсветки дисплея задействованы 4 канала white LED, что позволяет плавно регулировать яркость подсветки от 0 до 100, но как мы знаем в прошивке телефона уровни яркости дисплея реализована лишь от 0 до 7. Остальные 2 канала white LED не используются, они предназначены для подсветки внешнего дисплея, которого нет на E398.

У телефона "новогодняя ёлка" V80 задействованы оба RGB-канала на RGB-светодиоды, которых там четыре по два на канал. А все 6 каналов white LED неиспользуются вообще, подсветки дисплея там регулируется контроллером питания PCAP, поэтому при прошивке V80 на платформу R373 или E398/E1 на R37 в обоих случаях не работает подсветка дисплея.

У V600/V620 один или два RGB-светодиода, но самого понятия ритм-подсветки там нет, только подсветка различных событий. Вероятно все RGB-светодиоды так же висят на одном из каналов, второй вообще не используется. А вот используются ли для подсветки дисплея каналы LP3933 или же PCAP — большой и интересный вопрос, на который думаю скоро найдётся ответ, когда я портирую ELF на V600.

Даташит на микросхемку National Semiconductor LP3933:
